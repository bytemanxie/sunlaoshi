{% load static %}
<!DOCTYPE html>
<html lang="zh">

<head>
    <link rel="shortcut icon" href="{% static 'images/BFF.ico' %}" type="image/x-icon">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5">
    <title>孙老师 sunlaoshi</title>
    <meta name="description" content="">
    <meta name="keywords" content="Java,Spring,个人博客，微信小程序，博客">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="{% static 'index.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.css">
    <script type="text/javascript">
        if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
            alert('朋友，上古浏览器不支持呢~');
        }
    </script>
</head>

<body>
    <div id="body-wrap">
        <nav class="not_index_bg" id="nav" style="background-image:url(https://api.ixiaowai.cn/api/api.php)">
            <div id="page_site-info">
                <div id="site-title">
                    <span class="blogtitle"></span>
                    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>
                    <script>
                        var typed = new Typed(".blogtitle", {
                            strings: ['今天也要好好吃饭', 'Time flies, but we are the pilots'],
                            startDelay: 300,
                            typeSpeed: 100,
                            loop: true,
                            backSpeed: 50,
                            showCursor: true
                        });
                    </script>
                </div>
            </div>
        </nav>
        <main id="content-outer">
            <div class="layout_page" id="content-inner">
                <div class="aside_content" id="aside_content">
                    <div class="card-widget card-info">
                        <div class="card-content">
                            <div class="card-info-avatar is-center">
                                <img class="avatar-img"
                                    src={% static 'images/sun.jpg' %}
                                    alt="avatar">
                                <div class="author-info__name">SunLaoShi</div>
                                <div class="author-info__description">拥有灯泡的美少女</div>
                            </div>
                            <div class="card-info-social-icons is-center">
                                <a class="social-icon" href="https://weibo.com/u/1802576987" target="_blank">
                                    <i class="fa fa-weibo"></i>
                                </a>
                            </div>
                        </div>
                    </div>

                    <div class="card-widget card-announcement">
                        <div class="card-content">
                            <div class="item-headline">
                                <i class="fa fa-bullhorn" aria-hidden="true"></i>
                                <span>一言</span>
                            </div>
                            <div id="hitokoto"></div>
                        </div>
                    </div>
                    <div class="card-widget card-announcement">
                        <div class="card-content">
                            <div class="item-headline">
                                <i class="fa fa-calendar" aria-hidden="true"></i>
                                <span>今日诗词</span>
                            </div>
                            <div id="jinrishici-sentence"></div>
                        </div>
                    </div>

                    <div class="card-widget card-webinfo">
                        <div class="card-content">
                            <div class="item-headline">
                                <i class="fa fa-line-chart" aria-hidden="true"></i>
                                <span>站点信息</span>
                            </div>
                            <div class="webinfo">
                                <div class="webinfo-item">
                                    <div class="webinfo-site-uv-name">本站访客数 :</div>
                                    <div class="webinfo-site-uv-count" id="busuanzi_value_site_uv"></div>
                                </div>
                                <div class="webinfo-item">
                                    <div class="webinfo-site-name">本站总访问量 :</div>
                                    <div class="webinfo-site-pv-count" id="busuanzi_value_site_pv"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <article id="page">
                    <div class="article-container">
                        <h2>音乐</h2>
                        <meting-js 
                            server="tencent"
                            type="playlist"
                            id="665210960">
                        </meting-js>
                        <hr>

                        <h2>美少女</h2>
                        <div class="tool">
                            <a href="{% url 'happybirthdaypage' %}" class="btn bg-light text-danger" target="_blank" rel="noopener noreferrer">圣诞</a><br>
                        </div>

                        <hr>
                        <h2>倒计时</h2>
                        <div class="tool">
                            <a href="{% url 'happybirthdaypage' %}" class="btn bg-light text-danger" target="_blank" rel="noopener noreferrer">生日倒计时</a><br>
                        </div>

                        <hr>
                        <h2>年度总结</h2>
                        <div class="tool">
                            <a href="{% url 'wechat2023page' %}" class="btn bg-light text-danger" target="_blank" rel="noopener noreferrer">2023</a>
                        </div>
                    </div>
                </article>
            </div>
        </main>
        <footer id="footer">
            <div id="footer-wrap">
                <a href="https://beian.miit.gov.cn/" target="_blank">苏ICP备2024057854号-1</a>
            </div>
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery.fancybox@2.1.5/source/jquery.fancybox.js"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.js" type="module"></script>
    <script src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.0/lazysizes.min.js" async></script>
    <!-- aplayer、meting -->
    <!-- require APlayer -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
    <script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
    <!-- require MetingJS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script> -->
    <script>
        class MetingJSElement extends HTMLElement {

            connectedCallback() {
              if (window.APlayer && window.fetch) {
                this._init()
                this._parse()
              }
            }
          
            disconnectedCallback() {
              if (!this.lock) {
                this.aplayer.destroy()
              }
            }
          
            _camelize(str) {
              return str
                .replace(/^[_.\- ]+/, '')
                .toLowerCase()
                .replace(/[_.\- ]+(\w|$)/g, (m, p1) => p1.toUpperCase())
            }
          
            _init() {
              let config = {}
              for (let i = 0; i < this.attributes.length; i += 1) {
                config[this._camelize(this.attributes[i].name)] = this.attributes[i].value
              }
              let keys = [
                'server', 'type', 'id', 'api', 'auth',
                'auto', 'lock',
                'name', 'title', 'artist', 'author', 'url', 'cover', 'pic', 'lyric', 'lrc',
              ]
              this.meta = {}
              for (let key of keys) {
                this.meta[key] = config[key]
                delete config[key]
              }
              this.config = config
          
              this.api = this.meta.api || window.meting_api || 'https://api.injahow.cn/meting/?server=:server&type=:type&id=:id&auth=:auth&r=:r'
              if (this.meta.auto) this._parse_link()
            }
          
            _parse_link() {
              let rules = [
                ['music.163.com.*song.*id=(\\d+)', 'netease', 'song'],
                ['music.163.com.*album.*id=(\\d+)', 'netease', 'album'],
                ['music.163.com.*artist.*id=(\\d+)', 'netease', 'artist'],
                ['music.163.com.*playlist.*id=(\\d+)', 'netease', 'playlist'],
                ['music.163.com.*discover/toplist.*id=(\\d+)', 'netease', 'playlist'],
                ['y.qq.com.*song/(\\w+).html', 'tencent', 'song'],
                ['y.qq.com.*album/(\\w+).html', 'tencent', 'album'],
                ['y.qq.com.*singer/(\\w+).html', 'tencent', 'artist'],
                ['y.qq.com.*playsquare/(\\w+).html', 'tencent', 'playlist'],
                ['y.qq.com.*playlist/(\\w+).html', 'tencent', 'playlist'],
                ['xiami.com.*song/(\\w+)', 'xiami', 'song'],
                ['xiami.com.*album/(\\w+)', 'xiami', 'album'],
                ['xiami.com.*artist/(\\w+)', 'xiami', 'artist'],
                ['xiami.com.*collect/(\\w+)', 'xiami', 'playlist'],
              ]
          
              for (let rule of rules) {
                let patt = new RegExp(rule[0])
                let res = patt.exec(this.meta.auto)
                if (res !== null) {
                  this.meta.server = rule[1]
                  this.meta.type = rule[2]
                  this.meta.id = res[1]
                  return
                }
              }
            }
          
            _parse() {
              if (this.meta.url) {
                let result = {
                  name: this.meta.name || this.meta.title || 'Audio name',
                  artist: this.meta.artist || this.meta.author || 'Audio artist',
                  url: this.meta.url,
                  cover: this.meta.cover || this.meta.pic,
                  lrc: this.meta.lrc || this.meta.lyric || '',
                  type: this.meta.type || 'auto',
                }
                if (!result.lrc) {
                  this.meta.lrcType = 0
                }
                if (this.innerText) {
                  result.lrc = this.innerText
                  this.meta.lrcType = 2
                }
                this._loadPlayer([result])
                return
              }
          
              let url = this.api
                .replace(':server', this.meta.server)
                .replace(':type', this.meta.type)
                .replace(':id', this.meta.id)
                .replace(':auth', this.meta.auth)
                .replace(':r', Math.random())
          
              fetch(url)
                .then(res => res.json())
                .then(result => this._loadPlayer(result))
            }
          
            _loadPlayer(data) {
          
              let defaultOption = {
                audio: data,
                mutex: true,
                lrcType: this.meta.lrcType || 3,
                storageName: 'metingjs'
              }
          
              if (!data.length) return
          
              let options = {
                ...defaultOption,
                ...this.config,
              }
              for (let optkey in options) {
                if (options[optkey] === 'true' || options[optkey] === 'false') {
                  options[optkey] = (options[optkey] === 'true')
                }
              }
          
              let div = document.createElement('div')
              options.container = div
              this.appendChild(div)
          
              this.aplayer = new APlayer(options)
            }
          
          }
          
          console.log('\n %c MetingJS v2.0.1 %c https://github.com/metowolf/MetingJS \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
          
          if (window.customElements && !window.customElements.get('meting-js')) {
            window.MetingJSElement = MetingJSElement
            window.customElements.define('meting-js', MetingJSElement)
          }
    </script>

    <!-- nplayer -->
    <script src="https://unpkg.com/nplayer@latest/dist/index.min.js"></script>

    <!--   一言、今日诗词   -->
    <script src="https://v1.hitokoto.cn/?encode=js&select=%23hitokoto" defer></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>

    <!-- 看板娘 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/autoload.js"></script>

    <!--鼠标点击效果-->
    <script src="https://cdn.jsdelivr.net/gh/TRHX/CDN-for-itrhx.com@3.0.8/js/maodian.js"></script>

    <script type="text/javascript">

        (function ($) {
            $.fn.snow = function (options) {
                var $flake = $('<div id="snowbox" />').css({ 'position': 'absolute', 'z-index': '9999', 'top': '-50px' }).html('&#10052;'),
                    documentHeight = $(document).height(),
                    documentWidth = $(document).width(),
                    defaults = {
                        minSize: 10,
                        maxSize: 20,
                        newOn: 1000,
                        flakeColor: "#AFDAEF" /* 此处可以定义雪花颜色，若要白色可以改为#FFFFFF */
                    },
                    options = $.extend({}, defaults, options);
                var interval = setInterval(function () {
                    var startPositionLeft = Math.random() * documentWidth - 100,
                        startOpacity = 0.5 + Math.random(),
                        sizeFlake = options.minSize + Math.random() * options.maxSize,
                        endPositionTop = documentHeight - 200,
                        endPositionLeft = startPositionLeft - 500 + Math.random() * 500,
                        durationFall = documentHeight * 10 + Math.random() * 5000;
                    $flake.clone().appendTo('body').css({
                        left: startPositionLeft,
                        opacity: startOpacity,
                        'font-size': sizeFlake,
                        color: options.flakeColor
                    }).animate({
                        top: endPositionTop,
                        left: endPositionLeft,
                        opacity: 0.2
                    }, durationFall, 'linear', function () {
                        $(this).remove()
                    });
                }, options.newOn);
            };
        })(jQuery);
        $(function () {
            $.fn.snow({
                minSize: 5, /* 定义雪花最小尺寸 */
                maxSize: 50,/* 定义雪花最大尺寸 */
                newOn: 800  /* 定义密集程度，数字越小越密集 */
            });
        });

        // 浏览器搞笑标题
        var OriginTitle = document.title;
        var titleTime;
        document.addEventListener('visibilitychange', function () {
            if (document.hidden) {
                // $('[rel="icon"]').attr('href', "/funny.ico");
                document.title = '╭(°A°`)╮ 页面崩溃啦 ~';
                clearTimeout(titleTime);
            }
            else {
                $('[rel="icon"]').attr('href', "/favicon.ico");
                document.title = '(ฅ>ω<*ฅ) 噫又好啦 ~' + OriginTitle;
                titleTime = setTimeout(function () {
                    document.title = OriginTitle;
                }, 2000);
            }
        });
    </script>
</body>

</html>